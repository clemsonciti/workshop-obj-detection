















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-06-06 11:57:01 -0400">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/syntax.css" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>


    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="./assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="./assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="./assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="./assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="./assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="./assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="./assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="./assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="./assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Introduction to Applied Deep Learning: Object Detection using TensorFlow API"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="./assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="./assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="./assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="./assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="./assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Setup &ndash; Introduction to Applied Deep Learning: Object Detection using TensorFlow API
  </title>

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body beta">
    This lesson is being piloted (Beta version)
  </div>
</div>




    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="https://www.palmetto.clemson.edu" class="pull-left">
        <img class="navbar-logo" src="./assets/img/clemson.png" alt="West Chester University logo" />
      </a>

      
      <a class="navbar-brand" href="./index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

        
	
        <li><a href="./setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="./" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="./01-introduction/index.html">Introduction</a></li>
            
            
            <li><a href="./02-workspace/index.html">Preparing the workspace</a></li>
            
            
            <li><a href="./03-data-preparation/index.html">Preparing the data</a></li>
            
            
            <li><a href="./04-training/index.html">Training the models</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="./aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="./" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="./reference.html">Reference</a></li>
            
            
            <li><a href="./about/index.html">About</a></li>
            
            
            <li><a href="./discuss/index.html">Discussion</a></li>
            
            
            <li><a href="./figures/index.html">Figures</a></li>
            
            
            <li><a href="./guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="./LICENSE.html">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>
















<h1 class="maintitle"><a href="./index.html">Introduction to Applied Deep Learning: Object Detection using TensorFlow API</a>: Setup</h1>



<article>
<blockquote class="slide">
  <h2 id="1-request-a-palmetto-compute-node-with-k20-gpus">1. Request a Palmetto compute node with K20 GPUS</h2>

  <ul>
    <li>
      <p>Request an interactive session on a GPU node. This workshop is created for TensorFlow 2+. 
This version of TensorFlow requires AVX+ support from CPU, which is not available on the older 
nodes. It is important that you are aware of what type of CPU architecture is available on the node
on which you first installed TensorFlow.</p>
    </li>
    <li>
      <p>Request a node. For the purpose of the workshop, we will use nodes that have <code class="highlighter-rouge">k20</code> card. These are nodes in 
phases <code class="highlighter-rouge">8a</code>, <code class="highlighter-rouge">8b</code>, <code class="highlighter-rouge">9</code>, and <code class="highlighter-rouge">10</code>.</p>
    </li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qsub <span class="nt">-I</span> <span class="nt">-l</span> <span class="k">select</span><span class="o">=</span>1:ncpus<span class="o">=</span>16:mem<span class="o">=</span>60gb:ngpus<span class="o">=</span>2:gpu_model<span class="o">=</span>k20:interconnect<span class="o">=</span>10ge:phase<span class="o">=</span>8a,walltime<span class="o">=</span>72:00:00 <span class="nt">-q</span> deep
</code></pre></div>  </div>

</blockquote>

<blockquote class="slide">
  <h2 id="2-support-modules">2. Support modules</h2>

  <ul>
    <li>Load the necessary modules. TensorFlow is sensitive toward <a href="https://www.tensorflow.org/install/source#linux">cuda and cudnn versions</a>. 
We use TensorFlow 2.2 for this workshop, and therefore need cuda 10.1 and cudnn 7.6</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module load anaconda3/2019.10-gcc/8.3.1 cuda/10.1.243-gcc/8.3.1 cudnn/7.6.5.32-10.1-linux-x64-gcc/8.3.1
</code></pre></div>  </div>

</blockquote>

<blockquote class="slide">
  <h2 id="3-installing-tensorflow-in-a-python-virtual-environment">3. Installing TensorFlow in a Python virtual environment</h2>

  <ul>
    <li>Create a directory to store the Python virtual environment packages:</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkdir <span class="nt">-p</span> ~/software/venv
<span class="nv">$ </span>python3 <span class="nt">-m</span> venv ~/software/venv/tf_2.2
</code></pre></div>  </div>

  <ul>
    <li>Activate the virtual environment:</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">source</span> ~/software/venv/tf_2.2/bin/activate
</code></pre></div>  </div>

  <ul>
    <li>Install TensorFlow:</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip install <span class="nt">--upgrade</span> pip
<span class="nv">$ </span>pip install <span class="nv">tensorflow</span><span class="o">==</span>2.2
</code></pre></div>  </div>

  <ul>
    <li>This will automatically install some packages that are required for Tensorflow, like SciPy or NumPy.</li>
    <li>To test that TensorFlow was imported properly, you can do the following:</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python
<span class="o">&gt;&gt;&gt;</span> import tensorflow as tf
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span>tf.test.gpu_device_name<span class="o">())</span>
<span class="o">&gt;&gt;&gt;</span> quit<span class="o">()</span>

</code></pre></div>  </div>

  <ul>
    <li>The result should be similar (maybe not completely matched up) with the screenshot below</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/01.png" style="height:500px" /></p>

  <ul>
    <li>Install TensorFlow Jupyter Kernel:</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip install ipykernel
<span class="nv">$ </span>python3 <span class="nt">-m</span> ipykernel install <span class="nt">--user</span> <span class="nt">--name</span> tf_2.2 <span class="nt">--display-name</span> TF2.2
</code></pre></div>  </div>

</blockquote>

<blockquote class="slide">
  <h2 id="4-setup-object-detection-components">4. Setup object detection components</h2>

  <ul>
    <li>Create the directory and acquire the model files. We are using a copy of the tensorflow model Git repository downloaded 
on April 2021. This is to ensure that the versioning of tensorflow is <em>frozen</em> for this workshop.</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkdir ~/tensorflow
<span class="nv">$ </span><span class="nb">cd</span> ~/tensorflow
<span class="nv">$ </span>cp /zfs/citi/tf_downloads/models.tgz <span class="nb">.</span>
<span class="nv">$ </span><span class="nb">tar </span>xzf models.tgz
</code></pre></div>  </div>

  <ul>
    <li>Install and test the COCO (Common Objects in Context) API</li>
    <li><strong>It is important to keep in mind that you are doing this via a terminal that already source activated the virtual environment for TensorFlow</strong>.</li>
  </ul>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module load protobuf/3.11.2-gcc/8.3.1
<span class="nv">$ </span>pip install cython
<span class="nv">$ </span><span class="nb">cd</span> ~/tensorflow/models/research/
<span class="nv">$ </span>protoc object_detection/protos/<span class="k">*</span>.proto <span class="nt">--python_out</span><span class="o">=</span><span class="nb">.</span>
<span class="nv">$ </span>git clone https://github.com/cocodataset/cocoapi.git
<span class="nv">$ </span><span class="nb">cd </span>cocoapi/PythonAPI/
<span class="nv">$ </span>make
<span class="nv">$ </span>cp <span class="nt">-r</span> pycocotools ~/tensorflow/models/research/
<span class="nv">$ </span><span class="nb">cd</span> ~/tensorflow/models/research/
<span class="nv">$ </span>cp object_detection/packages/tf2/setup.py <span class="nb">.</span>
<span class="nv">$ </span>python <span class="nt">-m</span> pip install <span class="nb">.</span> <span class="nv">tensorflow</span><span class="o">==</span>2.2
<span class="nv">$ </span>python object_detection/builders/model_builder_tf2_test.py 
</code></pre></div>  </div>

  <ul>
    <li>The final test results should look similar to the following screenshot</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/11.png" style="height:500px" /></p>

</blockquote>

<blockquote class="slide">
  <h2 id="5-test-the-new-tensorflow-environment-on-openondemand">5. Test the new TensorFlow environment on OpenOnDemand</h2>

  <ul>
    <li>In this part you are introduced to the upcoming OpenOnDemand (OOD) environment to interact 
with Palmetto.</li>
    <li>At the moment, this interface is only accessible behind Clemson’s VPN</li>
    <li>Visit <code class="highlighter-rouge">https://openod02.palmetto.clemson.edu</code> and sign in.</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/02.png" style="height:500px" /></p>

  <ul>
    <li>Under <code class="highlighter-rouge">Interactive Apps</code>, select <code class="highlighter-rouge">Jupyter for TensorFlow</code>.</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/03.png" style="height:500px" /></p>

  <ul>
    <li>Fill in the form with allocation request parameters similar to the command line
you had earlier, as show in the screenshot below. Click <strong>Launch</strong> when done.
      <ul>
        <li><code class="highlighter-rouge">Number of resource chunk (select)</code>: 1</li>
        <li><code class="highlighter-rouge">CPU cores per chunk (ncpus)</code>: 16</li>
        <li><code class="highlighter-rouge">Amount of memory per chunk (mem)</code>: 62</li>
        <li><code class="highlighter-rouge">Number of GPUs per chunk (ngpus)</code>: 2</li>
        <li><code class="highlighter-rouge">GPU Model (gpu_model)</code>: K20</li>
        <li><code class="highlighter-rouge">Interconnect</code>: any</li>
        <li><code class="highlighter-rouge">Walltime</code>: 4 hours</li>
        <li><code class="highlighter-rouge">Queue</code>: work1</li>
        <li><code class="highlighter-rouge">List of modules to be loaded, separate by an empty space</code>: <code class="highlighter-rouge">anaconda3/2019.10-gcc/8.3.1 cuda/10.1.243-gcc/8.3.1 cudnn/7.6.5.32-10.1-linux-x64-gcc/8.3.1</code></li>
        <li><code class="highlighter-rouge">Path to Python virtual environment for TensorFlow</code>: <code class="highlighter-rouge">~/software/venv/tf_2.2</code></li>
      </ul>
    </li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/04.png" style="height:700px" /></p>

  <ul>
    <li>Click <strong>Connect to Jupyter</strong> when the link becomes available</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/05.png" style="height:400px" />
<img src="../workshop-obj-detection/fig/setup/06.png" style="height:400px" /></p>

  <ul>
    <li>Launch a new notebook using the <code class="highlighter-rouge">TF2.2</code> kernel created earlier</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/07.png" style="height:400px" /></p>

  <ul>
    <li>Run the commands in the shells as shown in the screenshot below to confirm a working notebook.</li>
  </ul>

  <p><img src="../workshop-obj-detection/fig/setup/08.png" style="height:400px" /></p>

</blockquote>


</article>


<!--  
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="">CC-BY 4.0</a> 2018–2021
	by <a href="">The Carpentries</a>
        <br>
        Licensed under <a href="">CC-BY 4.0</a> 2016–2018
	by <a href="">Software Carpentry Foundation</a>
	
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

       -->
    </div>
    
<script src="./assets/js/jquery.min.js"></script>
<script src="./assets/js/bootstrap.min.js"></script>
<script src="./assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
